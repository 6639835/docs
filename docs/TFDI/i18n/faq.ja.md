# ❓ TFDI ナビゲーションデータコンバーター FAQ

## 🔧 インストールと設定

### Q: コンバーターを使用するためにどのようなソフトウェアをインストールする必要がありますか？

**A:** 以下のソフトウェア環境が必要です：
- **Python 3.8+** (3.9 以降を推奨)
- **TFDI MD-11** が Microsoft Flight Simulator にインストール済みであること
- **Fenix A320** (ナビゲーションデータベースファイルを取得するため)
- 必要な Python 依存パッケージ (requirements.txt を介してインストール)

### Q: Fenix ナビゲーションデータベースファイルはどのように入手できますか？

**A:** Fenix データベースファイルは通常、以下の場所にあります：
```
%APPDATA%\Microsoft Flight Simulator\Packages\fenix-a320\SimObjects\Airplanes\FenixA320\navdata\nd.db3
```

**注意事項：**
- Fenix A320 がインストールされており、少なくとも一度実行されていることを確認してください
- データベースファイルのサイズは通常 50～200MB です
- ファイルは完全で破損していない SQLite データベースである必要があります

### Q: コンバーターはどのバージョンの Fenix と TFDI をサポートしていますか？

**A:** 現在サポートされているバージョン：
- **Fenix A320**: v1.0.x - v1.2.x
- **TFDI MD-11**: v1.0.x - v1.2.x
- **データベースフォーマット**: SQLite 3.x

**バージョン互換性：**
- ✅ 完全互換：Fenix v1.1.x + TFDI v1.1.x
- ⚠️ 検証が必要：最新バージョンには互換性アップデートを待つ必要がある場合があります
- ❌ 非サポート：古すぎるベータバージョン

## 📊 データ変換

### Q: 変換プロセスにはどのくらい時間がかかりますか？

**A:** 変換時間はデータベースのサイズに依存します：
- **小型データベース** (< 50MB): 2～5 分
- **中型データベース** (50～200MB): 5～15 分
- **大型データベース** (200～500MB): 15～45 分

**影響要因：**
- ハードディスクの種類 (SSD は HDD より 2～3 倍高速)
- 利用可能なメモリ (8GB以上を推奨)
- CPU性能 (マルチコアが有利)
- システム負荷 (不要なプログラムを閉じる)

### Q: ターミナル ID とは何ですか？どのように設定しますか？

**A:** ターミナル ID は、TFDI システム内でターミナル手順を識別するために使用される一意の識別番号です。

**設定の推奨事項：**
```
開始 ID: 1000 (デフォルト)
ID 範囲: 1-999999
推奨範囲: 1000-9000 (拡張スペースを残すため)
```

**割り当て戦略：**
- 各空港に 20～50 個の ID を予約
- 地域ごとにグループ化して割り当て (例：アジア地域 1000-3000)
- 既存の TFDI データとの衝突を避ける

### Q: 変換後のファイルはどこに保存されますか？

**A:** コンバーターは、以下のファイルを含む `Primary.7z` 圧縮アーカイブを生成します：

```
Primary.7z
├── AirportLookup.json      # 空港検索データ
├── Airports.json           # 空港情報
├── AirwayLegs.json        # 航空路区間データ
├── Airways.json           # 航空路定義
├── Ilses.json             # ILSアプローチデータ
├── NavaidLookup.json      # 航行援助施設検索
├── Navaids.json           # 航行援助施設データ
├── Runways.json           # 滑走路情報
├── Terminals.json         # ターミナル手順データ
├── WaypointLookup.json    # ウェイポイント検索
├── Waypoints.json         # ウェイポイント定義
└── ProcedureLegs/         # 手順区間ディレクトリ
    ├── TermID_1.json
    ├── TermID_2.json
    └── ...
```

### Q: FAF 点検出とは何ですか？なぜ重要ですか？

**A:** FAF (Final Approach Fix) は、精密アプローチ手順における最終アプローチフィックスです。

**重要性：**
- 精密アプローチの開始点をマークします
- VNAV 計算の重要な参照点
- オートパイロットのアプローチモードに影響します

**検出基準：**
- VNAV 角度 ≤ 2.5° (設定可能)
- アプローチ手順の最終段階に位置する
- 高度制限情報を持つ

## 🐛 トラブルシューティング

### Q: 「データベースファイル破損」エラーが発生した場合はどうすればよいですか？

**エラーメッセージ：**
```
SQLite Error: database disk image is malformed
データベースファイルが破損している可能性があります
```

**解決策：**
1.  **データベースの再取得**：
    ```bash
    # 破損している可能性のあるファイルを削除
    rm path/to/nd.db3
    
    # Fenix A320を再起動して再生成させる
    ```

2.  **ファイルの整合性を検証**：
    ```python
    import sqlite3
    
    try:
        conn = sqlite3.connect('nd.db3')
        conn.execute('PRAGMA integrity_check')
        print("データベースの整合性チェックに合格しました")
    except Exception as e:
        print(f"データベース破損: {e}")
    ```

3.  **データベース修復ツールを使用**：
    ```bash
    # SQLite ツールを使用して修復を試みる
    sqlite3 nd.db3 ".dump" | sqlite3 nd_repaired.db3
    ```

### Q: コンバーターが特定のステップでフリーズした場合はどうすればよいですか？

**フリーズする一般的なステップ：**
- データベース検証フェーズ
- 大容量テーブルデータ処理フェーズ
- JSONシリアル化フェーズ
- 圧縮・バンドル化フェーズ

**トラブルシューティング方法：**
```bash
# 1. システムリソースの確認
top  # Linux/macOS
# またはタスクマネージャー (Windows)

# 2. ログファイルの確認
tail -f converter.log

# 3. ディスク容量の確認
df -h  # Linux/macOS
# または Windows でドライブの空き容量を確認
```

**解決策：**
1.  **コンバーターの再起動**：完全に終了してから再起動
2.  **メモリの増設**：他のプログラムを閉じてメモリを解放
3.  **権限の確認**：書き込み権限があることを確認
4.  **ステップバイステップデバッグ**：デバッグモードを使用して詳細情報を確認

### Q: 変換後の JSON ファイルが TFDI で認識されない場合はどうすればよいですか？

**考えられる原因：**
1.  **バージョン非互換**：TFDI バージョンと JSON フォーマットバージョンが一致しない
2.  **ファイル破損**：圧縮または転送中にファイルが破損
3.  **フォーマットエラー**：JSON フォーマットが TFDI 標準に準拠していない
4.  **エンコーディングの問題**：文字エンコーディングが正しくない

**検証手順：**
```bash
# 1. JSONフォーマットの検証
python -m json.tool Primary/Airports.json

# 2. ファイルサイズの確認
ls -lh Primary/

# 3. 圧縮アーカイブの整合性を検証
7z t Primary.7z
```

**修復方法：**
1.  **再変換**：出力フォルダを削除してから再変換
2.  **手動解凍**：7z ファイルを解凍して内容を確認
3.  **バージョン更新**：最新バージョンのコンバーターを使用していることを確認
4.  **サポートへのお問い合わせ**：問題が解決しない場合はバグを報告してください

## 📈 パフォーマンス最適化

### Q: 変換速度を向上させるにはどうすればよいですか？

**ハードウェア最適化：**
- **SSD の使用**：ソリッドステートドライブはメカニカルハードドライブより 3～5 倍高速
- **メモリの増設**：8GB+ RAM を推奨
- **マルチコア CPU**：並列処理をサポート
- **アンチウイルスを無効にする**：リアルタイムスキャンを一時的に無効にする

**ソフトウェア最適化：**
```python
# 設定パラメータの調整
config = ConverterConfig(
    coordinate_precision=6,    # 精度を下げて速度を向上させる
    batch_size=2000,          # バッチサイズを増やす
    enable_compression=False,  # リアルタイム圧縮を無効にする
    max_workers=4             # 並列スレッド数を設定
)
```

**環境最適化：**
```bash
# 環境変数の設定
export PYTHONOPTIMIZE=1       # バイトコード最適化を有効にする
export SQLITE_TEMP_STORE=3    # メモリ一時ストレージを使用
```

### Q: メモリ使用量が高すぎる場合はどうすればよいですか？

**メモリ使用量の監視：**
```python
import psutil

def monitor_memory():
    memory = psutil.virtual_memory()
    print(f"メモリ使用率: {memory.percent}%")
    print(f"利用可能なメモリ: {memory.available // 1024**2} MB")
```

**最適化戦略：**
1.  **バッチサイズを減らす**：
    ```python
    config.batch_size = 500  # デフォルトの 1000 から 500 に減らす
    ```

2.  **段階的な処理**：
    ```python
    # 大容量テーブルをバッチ処理
    tables = ['Airports', 'Runways', 'Waypoints']
    for table in tables:
        converter.process_table(table)
        gc.collect()  # 強制ガベージコレクション
    ```

3.  **ストリーミング処理**：大容量ファイルを処理するためにストリーミング処理モードを有効にする

### Q: 複数のコンバーターインスタンスを同時に実行できますか？

**技術的には可能ですが、制限があります：**
- **データベースロック**：SQLite は複数の書き込み接続をサポートしていません
- **リソース競合**：複数のインスタンスが CPU とメモリを競合します
- **ディスク I/O**：ディスクのボトルネックを引き起こす可能性があります

**推奨される方法：**
```bash
# 複数のデータベースを順次処理
python converter.py --input db1.db3 --output output1/
python converter.py --input db2.db3 --output output2/

# またはバッチスクリプトを使用
for db in *.db3; do
    python converter.py --input "$db" --output "output_${db%.*}/"
done
```

## 🔍 データ検証

### Q: 変換結果の正確性を検証する方法は？

**自動検証ツール：**
```python
# 内蔵バリデーターを使用
from tfdi_converter.validation import DataValidator

validator = DataValidator()
result = validator.validate_output("Primary.7z")

if result.is_valid:
    print("✅ 検証合格")
else:
    print("❌ 検証失敗:")
    for error in result.errors:
        print(f"  - {error}")
```

**手動検証チェックリスト：**
- [ ] **ファイル整合性**：必要なすべての JSON ファイルが存在すること
- [ ] **データ量**：レコード数が適切で異常な減少がないこと
- [ ] **座標範囲**：緯度 [-90, 90]、経度 [-180, 180] であること
- [ ] **参照整合性**：外部キー関係が完全に保持されていること
- [ ] **特殊文字**：UTF-8 エンコーディングが正しく処理されていること

**TFDIでの検証：**
1.  変換されたデータパッケージをインストール
2.  フライトプランを作成して航空路をテスト
3.  FMCでの手順表示を確認
4.  航行援助施設の周波数と位置を検証

### Q: 変換後のデータ量が著しく減少した原因は何ですか？

**考えられる原因：**
1.  **データフィルタリング**：コンバーターが互換性のないデータまたは無効なデータをフィルタリングした
2.  **地域の制限**：特定の地域のデータのみが変換された可能性がある
3.  **フォーマットの制限**：一部の Fenix 固有のフォーマットは変換できない
4.  **バージョン間の差異**：異なるバージョン間でデータ構造に差異がある

**確認方法：**
```python
# 変換前後のレコード数を比較
def compare_record_counts(fenix_db, tfdi_json_dir):
    # Fenix データベースのレコードをカウント
    fenix_counts = count_fenix_records(fenix_db)
    
    # TFDI JSON レコードをカウント
    tfdi_counts = count_tfdi_records(tfdi_json_dir)
    
    # 結果を比較
    for table, fenix_count in fenix_counts.items():
        tfdi_count = tfdi_counts.get(table, 0)
        ratio = tfdi_count / fenix_count if fenix_count > 0 else 0
        print(f"{table}: {fenix_count} → {tfdi_count} ({ratio:.1%})")
```

## 🆘 ヘルプの取得

### Q: 技術サポートはどこで受けられますか？

**公式サポートチャネル：**
- **GitHub Issues**: バグ報告と機能リクエスト
- **GitHub Discussions**: 使用に関する質問と一般的な議論
- **プロジェクトドキュメント**: 完全なユーザーガイドを参照
- **サンプルコード**: プロジェクト内の例を参照

**コミュニティサポート：**
- **飛行模擬フォーラム**: 関連するフライトシミュレーションコミュニティ
- **Discord グループ**: リアルタイムの交流と相互扶助
- **QQ/WeChat グループ**: 中国語ユーザー交流グループ

### Q: 問題の報告または新機能の提案方法

**問題報告プロセス：**
1.  **既存の問題を検索**：重複報告を避ける
2.  **情報収集**：
    - 詳細なエラー説明
    - 完全なエラーログ
    - システム環境情報
    - 再現手順
3.  **Issue の作成**：提供されたテンプレートを使用
4.  **例の提供**：可能であれば、最小限の再現例を提供する

**機能提案：**
- 新機能の用途を詳細に説明
- 機能の期待される動作を説明
- 既存ユーザーへの影響を考慮
- 実装の提案を提供 (もしあれば)

### Q: コードを貢献できますか？開発に参加するにはどうすればよいですか？

**貢献方法：**
- **バグ修正**：既知の問題の修正
- **新機能開発**：新しい変換機能の実装
- **パフォーマンス最適化**：変換速度と効率の向上
- **ドキュメント改善**：ユーザーガイドと API ドキュメントの改善
- **テスト強化**：テストケースとカバレッジを増やす

**参加手順：**
1.  **プロジェクトを Fork する**：自分のプロジェクトブランチを作成
2.  **開発環境のセットアップ**：貢献ガイドラインに従って設定
3.  **タスクの選択**：Issues から適切なタスクを選択
4.  **開発とテスト**：コードを記述し、テストがパスすることを確認
5.  **PR を提出**：プルリクエストを作成し、レビューを待つ

**貢献要件：**
- プロジェクトのコーディング規約に従う
- 十分なテストカバレッジを提供する
- 関連ドキュメントを更新
- 明確なコミットメッセージを使用

---

**答えが見つかりませんか？**

[GitHub Issues](https://github.com/your-org/tfdi-converter/issues) で検索するか、新しい問題を作成してください。できるだけ早く返信いたします！🚁✨