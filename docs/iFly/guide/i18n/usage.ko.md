# 🚀 iFly 항법 데이터 변환기 사용 가이드

본 가이드는 iFly 항법 데이터 변환기를 사용하는 방법을 기초 작업부터 고급 기능까지 자세히 소개하여, Fenix에서 iFly로 항법 데이터를 원활하게 변환하도록 돕습니다.

## 🎯 사용 전 준비

### 1. 파일 준비 체크리스트

변환을 시작하기 전에 다음 파일들이 준비되었는지 확인하십시오:

- ✅ **Fenix 항법 데이터베이스** (`nd.db3`)
  ```
  위치: %APPDATA%\Microsoft Flight Simulator\Packages\fenix-a320\SimObjects\Airplanes\FenixA320\navdata\nd.db3
  크기: 일반적으로 50-200MB
  형식: SQLite 데이터베이스 파일
  ```

- ✅ **NAIP 항로 데이터** (`RTE_SEG.csv`)
  ```
  출처: 중국 민항 데이터 서비스 웹사이트
  인코딩: UTF-8
  크기: 일반적으로 5-20MB
  형식: 항로 구간 정보가 포함된 CSV 파일
  ```

- ✅ **iFly 737 MAX 8**이 설치되어 정상적으로 실행 가능해야 합니다.

### 2. 환경 검증

환경 검사 스크립트 실행:
```bash
# Python 환경 확인
python --version  # 3.8 이상 버전이 표시되어야 합니다

# 의존성 패키지 확인
python -c "import rich, pandas, pygeomag; print('환경 검증 통과!')"

# 사용 가능한 메모리 확인
python -c "import psutil; print(f'사용 가능한 메모리: {psutil.virtual_memory().available // (1024**3)} GB')"
```

## 🖥️ 대화형 사용

### 변환기 시작

```bash
# 프로젝트 디렉토리로 이동
cd /path/to/ifly-converter

# 변환기 시작
python main.py
```

### 환영 화면

변환기가 시작되면 현대적인 환영 화면이 나타납니다:

```
╔═══════════════════════════════════════ 🛩️  항공 항법 데이터 변환 도구  ✈️ ═══════════════════════════════════════╗
║                                                                                                          ║
║                                      Fenix에서 iFly로 항공 항법 데이터 변환기                                       ║
║                                          고품질, 현대적인 변환 경험                                         ║
║                                                                                                          ║
╚═══════════════════════════════════════ Powered by Rich • 버전 2.0 ═══════════════════════════════════════╝

🔍 시스템 검사 중...
✅ Python 환경: 3.9.16
✅ 의존성 패키지: 모두 설치됨
✅ 사용 가능한 메모리: 8.2 GB
✅ 디스크 공간: 125 GB

변환 과정 시작 준비 중...
```

## 📋 변환 단계 상세 설명

### 단계 1: Fenix 데이터베이스 연결

```
╭─────────────────────────────────────────────── 🔄 단계 1/4 ────────────────────────────────────────────────╮
│ Fenix 데이터베이스 연결                                                                                        │
│ Fenix A320 항법 데이터베이스 파일 (nd.db3)을 선택하십시오.                                                                │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────╯

Fenix 데이터베이스 파일 경로를 입력하십시오: 
```

**입력 예시:**
```bash
# Windows 경로
C:\Users\Username\AppData\Roaming\Microsoft Flight Simulator\Packages\fenix-a320\SimObjects\Airplanes\FenixA320\navdata\nd.db3

# 또는 Enter를 눌러 자동 감지 사용
[Enter를 눌러 자동 감지 사용]
```

**검증 과정:**
```
🔍 데이터베이스 검증 중...
✅ 파일이 존재하고 읽기 가능
✅ 데이터베이스 형식이 올바름
✅ 필수 테이블 완료 (11/11)
📊 데이터 통계:
   • 공항: 15,234 개
   • 활주로: 28,456 개
   • 웨이포인트: 156,789 개
   • 터미널 절차: 8,945 개
```

### 단계 2: CSV 파일 선택

```
╭─────────────────────────────────────────────── 🔄 단계 2/4 ────────────────────────────────────────────────╮
│ NAIP 항로 데이터 선택                                                                                        │
│ 중국 민항 RTE_SEG.csv 파일을 선택하십시오.                                                                           │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────╯

CSV 파일 경로를 입력하십시오:
```

**검증 과정:**
```
🔍 CSV 파일 검증 중...
✅ 파일 인코딩: UTF-8
✅ 형식 검증 통과
✅ 필수 열 존재
📊 데이터 미리보기:
   • 총 레코드 수: 12,456 개
   • 항로 수: 345 개
   • 적용 지역: 중국 본토, 홍콩, 마카오
   • 데이터 유효 기간: AIRAC 2508
```

### 단계 3: iFly 설치 위치 지정

```
╭─────────────────────────────────────────────── 🔄 단계 3/4 ────────────────────────────────────────────────╮
│ iFly 설치 위치 지정                                                                                            │
│ iFly 737 MAX 8 설치 위치를 검색 중...                                                                       │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────╯

🔍 일반적인 설치 위치 스캔 중...
✅ iFly 설치 위치 발견: Community\ifly-aircraft-737max8\
📁 설치 경로: C:\Users\Username\AppData\Local\Packages\Microsoft.FlightSimulator_xxx\LocalCache\Packages\Community\ifly-aircraft-737max8\
📋 디렉터리 구조 검증:
   ✅ Data\navdata\Permanent\
   ✅ Data\navdata\Supplemental\
   ✅ 쓰기 권한 정상
```

자동 감지 실패 시, 시스템은 수동 입력을 요청합니다:
```
❌ 자동 감지 실패
iFly 737 MAX 8 설치 경로를 수동으로 입력하십시오:
```

### 단계 4: 변환 옵션 구성

```
╭─────────────────────────────────────────────── 🔄 단계 4/4 ────────────────────────────────────────────────╮
│ 변환 옵션 구성                                                                                              │
│ 터미널 절차 처리 매개변수 설정                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────╯

터미널 절차 ID 시작 값 [기본값: 1000]:
```

**구성 옵션 설명:**
```
📊 터미널 절차 ID 구성:
   • 시작 ID: 1000 (권장)
   • 예상 사용 범위: 1000-3500
   • 사용 가능한 총 ID 수: 9000
   • 권장 예비: 20% 버퍼

⚙️ 기타 옵션:
   • 좌표 정밀도: 소수점 8자리 (기본값)
   • 자기 편차 계산: WMM-2025 모델
   • AIRAC 주기: 자동 계산
```

## 🔄 변환 과정

### 구성 확인

변환 시작 전에 시스템은 전체 구성 요약을 표시합니다:

```
┌────────────────────────────────── ✅ 변환 구성 확인 ──────────────────────────────────┐
│                                                                                   │
│  📂 데이터 원본 구성                                                                     │
│  ├─ Fenix 데이터베이스: .../navdata/nd.db3 (142.5 MB)                                  │
│  ├─ NAIP CSV 파일: .../RTE_SEG.csv (8.2 MB)                                      │
│  └─ iFly 설치 경로: .../ifly-aircraft-737max8/                                    │
│                                                                                   │
│  ⚙️ 처리 매개변수                                                                       │
│  ├─ 터미널 절차 시작 ID: 1000                                                          │
│  ├─ 좌표 정밀도: 소수점 8자리                                                             │
│  ├─ 자기 편차 모델: WMM-2025                                                           │
│  └─ AIRAC 주기: 2508 (자동 계산)                                                    │
│                                                                                   │
│  📊 예상 처리                                                                       │
│  ├─ 웨이포인트: ~12,456 개                                                            │
│  ├─ 터미널 절차: ~350 개                                                             │
│  └─ 예상 시간: 5-10 분                                                           │
│                                                                                   │
└───────────────────────────────────────────────────────────────────────────────────┘

변환을 시작하시겠습니까? [Y/n]:
```

### 항로 데이터 처리

```
╭─────────────────────────────────────────── 🛣️ 항로 데이터 처리 ───────────────────────────────────────────╮
│                                                                                                      │
│ NAIP 항로 구간 데이터 처리 중...                                                                          │
│                                                                                                      │
│ ████████████████████████████████████████ 12,456/12,456 (100%) ⏱️ 0:03:45                         │
│                                                                                                      │
│ 현재 처리 중: A1 항로 → ZSAM-VOR01 구간                                                                   │
│ 자기 편차 계산: 39.917°N, 116.383°E → +7.2°                                                            │
│                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────╯

📊 항로 처리 통계:
✅ 성공적으로 처리: 12,456 개 웨이포인트
✅ 자기 편차 계산: 12,456 회 (평균 0.02초/회)
✅ 출력 파일: WPNAVRTE.txt (2.3 MB 증가)
⚠️ 건너뛴 기록: 23 개 (좌표 이상)
```

### 터미널 절차 처리

```
╭─────────────────────────────────────────── 🏢 터미널 절차 처리 ───────────────────────────────────────────╮
│                                                                                                      │
│ 터미널 절차 데이터 변환 중...                                                                              │
│                                                                                                      │
│ ████████████████████████████████████████ 350/350 (100%) ⏱️ 0:02:15                               │
│                                                                                                      │
│ 현재 처리 중: ZBAA (베이징 수도) → SID SHUAY1A                                                             │
│ 절차 유형: 표준 계기 이륙 절차                                                                           │
│                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────╯

📊 터미널 절차 통계:
✅ 처리 공항: 145 개
✅ SID 절차: 234 개
✅ STAR 절차: 198 개  
✅ 접근 절차: 312 개
✅ 새로 추가된 파일: 89 개
✅ 업데이트된 파일: 56 개
```

### AIRAC 주기 관리

```
╭─────────────────────────────────────────── 📅 AIRAC 주기 관리 ──────────────────────────────────────────╮
│                                                                                                      │
│ AIRAC 주기 계산 및 설정 중...                                                                         │
│                                                                                                      │
│ 🗓️ 계산 정보                                                                                          │
│ ├─ 기준 날짜: 2024-01-11 (AIRAC 2401)                                                               │
│ ├─ 현재 날짜: 2024-12-24                                                                             │
│ ├─ 경과 일수: 348 일                                                                                  │
│ ├─ 경과 주기: 12.43 → 12 개 완전 주기                                                                   │
│ └─ 현재 주기: 2508                                                                                    │
│                                                                                                      │
│ 📋 주기 상세 정보                                                                                          │
│ ├─ AIRAC 식별: 2508                                                                                 │
│ ├─ 유효 시작일: 2024-12-19                                                                             │
│ ├─ 유효 종료일: 2025-01-16                                                                             │
│ └─ 남은 일수: 23 일                                                                                   │
│                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────╯

✅ AIRAC 파일이 생성됨: FMC_Ident.txt
```

## ✅ 변환 완료

### 성공 요약

```
┌─────────────────────────────────────────── ✅ 변환 완료 ───────────────────────────────────────────────┐
│                                                                                                        │
│  🎉 축하합니다! 항법 데이터 변환이 성공적으로 완료되었습니다.                                           │
│                                                                                                        │
│  📊 처리 통계                                                                                            │
│  ├─ 🛣️ 항로 데이터: 12,456 개 웨이포인트                                                                       │
│  ├─ 🏢 터미널 절차: 350 개 절차 (145 개 공항)                                                               │
│  ├─ 📅 AIRAC 주기: 2508                                                                               │
│  └─ ⏱️ 총 소요 시간: 6분 32초                                                                             │
│                                                                                                        │
│  📁 출력 파일                                                                                            │
│  ├─ WPNAVRTE.txt: 항로 데이터 (+2.3 MB)                                                                  │
│  ├─ FMC_Ident.txt: AIRAC 식별 파일                                                                     │
│  ├─ Supplemental: 89 개 새 절차 파일                                                                      │
│  └─ 변환 로그: converter.log                                                                           │
│                                                                                                        │
│  🔄 다음 권장 사항                                                                                          │
│  1. Microsoft Flight Simulator 재시작                                                                   │
│  2. iFly 737 MAX 8 로드                                                                               │
│  3. FMC에서 새로운 항로 및 절차 확인                                                                        │
│  4. 복구를 위해 백업 파일 저장                                                                               │
│                                                                                                        │
└────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 파일 위치 설명

변환 완료 후 파일은 다음 위치에 배치됩니다:

```
📁 iFly 항법 데이터 디렉토리:
Community\ifly-aircraft-737max8\Data\navdata\

├── Permanent\
│   ├── WPNAVRTE.txt        # 항로 데이터 (업데이트됨)
│   └── 기타 원본 파일...
│
├── Supplemental\
│   ├── ZBAA\              # 베이징 수도 공항
│   │   ├── SID\           # 표준 계기 이륙 절차
│   │   ├── STAR\          # 표준 터미널 도착 절차
│   │   └── APP\           # 접근 절차
│   ├── ZSPD\              # 상하이 푸둥 공항
│   └── ...기타 공항
│
└── FMC_Ident.txt          # AIRAC 식별 파일
```

## 🧪 변환 결과 검증

### 1. 파일 검증

```bash
# 파일 생성 여부 확인
ls -la "Community\ifly-aircraft-737max8\Data\navdata\"

# 파일 크기 확인 (변환 전보다 커야 함)
du -h "Community\ifly-aircraft-737max8\Data\navdata\Permanent\WPNAVRTE.txt"

# AIRAC 식별자 확인
cat "Community\ifly-aircraft-737max8\Data\navdata\FMC_Ident.txt"
```

### 2. 시뮬레이터 검증

1.  **MSFS 재시작**: 시뮬레이터를 완전히 종료하고 다시 시작합니다.
2.  **iFly 737 로드**: iFly 737 MAX 8을 선택합니다.
3.  **FMC 확인**:
    ```
    FMC 메인 페이지 → INIT REF → AIRAC 주기 확인
    표시되어야 함: AIRAC 2508
    ```
4.  **항로 테스트**:
    ```
    ROUTE 페이지 → 중국 항로 입력 (예: A1, B1)
    웨이포인트와 거리가 올바르게 표시되어야 함
    ```

### 3. 기능 테스트 체크리스트

-   [ ] **AIRAC 주기가 올바르게 표시됨**
-   [ ] **중국 항로 로드 가능** (A1, B1, G212 등)
-   [ ] **공항 절차 완전** (SID, STAR, APP)
-   [ ] **웨이포인트 좌표 정확**
-   [ ] **자기 편차 계산 정확**
-   [ ] **FMC 항법 정상**

## 🔧 고급 사용법

### 일괄 처리 모드

현재 버전은 일괄 처리를 직접 지원하지 않지만, 스크립트를 통해 구현할 수 있습니다:

```python
# batch_convert.py
import subprocess
import os

databases = [
    "path/to/fenix_db1.db3",
    "path/to/fenix_db2.db3"
]

csv_file = "path/to/RTE_SEG.csv"

for db in databases:
    print(f"데이터베이스 처리 중: {db}")
    # 여기서는 main.py를 수정하여 명령줄 매개변수를 지원해야 합니다.
    # subprocess.run(["python", "main.py", "--db", db, "--csv", csv_file])
```

### 사용자 정의 구성 파일

자주 사용하는 구성을 저장하기 위해 `config.json` 파일을 생성합니다:

```json
{
    "default_fenix_path": "C:\\Users\\Username\\AppData\\Roaming\\Microsoft Flight Simulator\\Packages\\fenix-a320\\SimObjects\\Airplanes\\FenixA320\\navdata\\nd.db3",
    "default_csv_path": "D:\\Nav-Data\\RTE_SEG.csv",
    "terminal_id_start": 1500,
    "coordinate_precision": 8,
    "enable_backup": true,
    "backup_directory": "D:\\Nav-Data\\Backups"
}
```

### 데이터 업데이트 절차

권장되는 정기 업데이트 절차:

```bash
# 1. 현재 데이터 백업
cp -r "Community\ifly-aircraft-737max8\Data\navdata" "backup_$(date +%Y%m%d)"

# 2. 최신 NAIP 데이터 다운로드
# (공식 웹사이트에서 새로운 RTE_SEG.csv 다운로드)

# 3. 최신 Fenix 데이터베이스 가져오기
# (Fenix A320이 최신 버전으로 업데이트되었는지 확인)

# 4. 변환기 실행
python main.py

# 5. 결과 검증
# (시뮬레이터에서 새 데이터 테스트)
```

## ⚠️ 주의사항

### 중요 알림

1.  **데이터 백업**: 변환 전에 반드시 원본 iFly 항법 데이터를 백업하십시오.
2.  **버전 호환성**: Fenix A320 및 iFly 737 MAX 8의 최신 버전을 사용하는지 확인하십시오.
3.  **시의성**: AIRAC 데이터는 28일마다 업데이트하는 것을 권장합니다.
4.  **검증 테스트**: 변환 후 주요 항로에서 테스트 비행을 수행하십시오.

### 성능 최적화

1.  **SSD 사용**: 데이터 파일을 SSD에 두어 처리 속도를 높이십시오.
2.  **백신 끄기**: 파일 액세스 충돌을 피하기 위해 실시간 스캔을 일시적으로 끄십시오.
3.  **충분한 메모리**: 최소 4GB의 사용 가능한 메모리가 있는지 확인하십시오.
4.  **안정적인 전원**: UPS를 사용하거나 전원 공급이 안정적인지 확인하십시오.

### 문제 해결

변환 과정에서 문제가 발생하면:

1.  **로그 확인**: `converter.log` 파일의 오류 정보를 확인하십시오.
2.  **작업 재시도**: 일부 네트워크 또는 파일 액세스 문제는 일시적일 수 있습니다.
3.  **캐시 정리**: 임시 파일을 삭제한 후 다시 시도하십시오.
4.  **설정 하향 조정**: 메모리가 부족하면 배치 처리 크기를 줄일 수 있습니다.

---

**학습을 완료하신 것을 축하드립니다!** 🎉

이제 iFly 항법 데이터 변환기의 전체 사용 방법을 숙지하셨습니다. 문제가 발생하면 [문제 해결 가이드](../troubleshooting.md) 또는 [자주 묻는 질문](../faq.md)을 참조하십시오.

즐거운 비행 되십시오! ✈️